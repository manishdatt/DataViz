{
  "hash": "e3376328db7375128126d93553447ef7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Historic UK Meteorological & Climate Data\nmarimo-version: 0.17.0\nauthor: Manish Datt\ndate: '2025-10-21'\niso-date: '2025-10-21'\ndescription: >-\n  Monthly variation in maximum temperature.\nimage: UK_weather.png\ncategories:\n- Catplot\n- stripplot\n- TidyTuesday\nslug: 25A3\n---\n\n# TidyTuesday dataset of [{{<meta date>}}](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/{{<meta iso-date>}})\n\n::: {#b60bd103 .cell execution_count=1}\n``` {.python .cell-code}\nimport marimo as mo\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport matplotlib.cm as cm\nimport matplotlib.colors as mcolors\nimport textwrap\n```\n:::\n\n\n::: {#209f7d08 .cell execution_count=2}\n``` {.python .cell-code}\nhistoric_station_met = pd.read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-10-21/historic_station_met.csv')\nstation_meta = pd.read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-10-21/station_meta.csv')\n```\n:::\n\n\n::: {#dd7cf18a .cell execution_count=3}\n``` {.python .cell-code}\nhistoric_station_met\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>station</th>\n      <th>year</th>\n      <th>month</th>\n      <th>tmax</th>\n      <th>tmin</th>\n      <th>af</th>\n      <th>rain</th>\n      <th>sun</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>aberporth</td>\n      <td>1941</td>\n      <td>1</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>74.7</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>aberporth</td>\n      <td>1941</td>\n      <td>2</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>69.1</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>aberporth</td>\n      <td>1941</td>\n      <td>3</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>76.2</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>aberporth</td>\n      <td>1941</td>\n      <td>4</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>33.7</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>aberporth</td>\n      <td>1941</td>\n      <td>5</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>51.3</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>39143</th>\n      <td>yeovilton</td>\n      <td>2024</td>\n      <td>8</td>\n      <td>22.2</td>\n      <td>12.8</td>\n      <td>0.0</td>\n      <td>27.4</td>\n      <td>141.1</td>\n    </tr>\n    <tr>\n      <th>39144</th>\n      <td>yeovilton</td>\n      <td>2024</td>\n      <td>9</td>\n      <td>18.3</td>\n      <td>10.7</td>\n      <td>0.0</td>\n      <td>142.8</td>\n      <td>107.6</td>\n    </tr>\n    <tr>\n      <th>39145</th>\n      <td>yeovilton</td>\n      <td>2024</td>\n      <td>10</td>\n      <td>16.2</td>\n      <td>8.1</td>\n      <td>0.0</td>\n      <td>102.0</td>\n      <td>85.2</td>\n    </tr>\n    <tr>\n      <th>39146</th>\n      <td>yeovilton</td>\n      <td>2024</td>\n      <td>11</td>\n      <td>11.7</td>\n      <td>5.1</td>\n      <td>7.0</td>\n      <td>88.6</td>\n      <td>48.8</td>\n    </tr>\n    <tr>\n      <th>39147</th>\n      <td>yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>10.5</td>\n      <td>5.0</td>\n      <td>1.0</td>\n      <td>29.6</td>\n      <td>27.9</td>\n    </tr>\n  </tbody>\n</table>\n<p>39148 rows × 8 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#4dd2561e .cell execution_count=4}\n``` {.python .cell-code}\nhistoric_station_met['year'] = pd.to_datetime(historic_station_met['year']).astype(int)\n```\n:::\n\n\n::: {#891c1fd1 .cell execution_count=5}\n``` {.python .cell-code}\nbins = [1850, 1925, 1950, 1975, 2000, 2025]\nlabels = ['till 1925', '1926–1950', '1951–1975', '1976–2000', '2001 onwards']\nhistoric_station_met['quarter'] = pd.cut(historic_station_met['year'], bins=bins, labels=labels)\n```\n:::\n\n\n::: {#9172525f .cell execution_count=6}\n``` {.python .cell-code}\nhistoric_station_met['tdiff'] = historic_station_met['tmax']-historic_station_met['tmin']\nhistoric_station_met['station'] = historic_station_met['station'].str.capitalize()\n```\n:::\n\n\n::: {#05798579 .cell execution_count=7}\n``` {.python .cell-code}\nhistoric_station_met.columns\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\nIndex(['station', 'year', 'month', 'tmax', 'tmin', 'af', 'rain', 'sun',\n       'quarter', 'tdiff'],\n      dtype='object')\n```\n:::\n:::\n\n\n::: {#2a1a719e .cell execution_count=8}\n``` {.python .cell-code}\ndf_grp = historic_station_met.groupby(['station','year', 'month', 'quarter']).agg({\n    'tmax': 'max',\n    'tmin': 'min',\n    'tdiff': 'mean',\n    'af': 'sum',\n    'rain': 'sum',\n     'sun': 'sum'\n}).reset_index()\ndf_grp\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>station</th>\n      <th>year</th>\n      <th>month</th>\n      <th>quarter</th>\n      <th>tmax</th>\n      <th>tmin</th>\n      <th>tdiff</th>\n      <th>af</th>\n      <th>rain</th>\n      <th>sun</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>1</td>\n      <td>till 1925</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>1</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>1</td>\n      <td>1951–1975</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>1</td>\n      <td>1976–2000</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>1</td>\n      <td>2001 onwards</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>381835</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>till 1925</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381836</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381837</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>1951–1975</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381838</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>1976–2000</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381839</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>2001 onwards</td>\n      <td>10.5</td>\n      <td>5.0</td>\n      <td>5.5</td>\n      <td>1.0</td>\n      <td>29.6</td>\n      <td>27.9</td>\n    </tr>\n  </tbody>\n</table>\n<p>381840 rows × 10 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {#b0bc4dc2 .cell execution_count=9}\n``` {.python .cell-code}\n# Group by both station and year\ngrouped = historic_station_met.groupby(['station', 'year'])\n\n# Dictionary to store correlation results\ncorrelations = {}\n\n# Loop through each (station, year) group\nfor (station, year), df_grp1 in grouped:\n    # Compute correlation between 'rain' and 'sun'\n    corr_matrix = df_grp1[['rain', 'sun']].corr()\n    corr_value = corr_matrix.loc['rain', 'sun']\n\n    # Store result with a tuple key\n    correlations[(station, year)] = corr_value\n\ncorrelation_df = pd.DataFrame.from_dict(\n    correlations, orient='index', columns=['rain_sun_corr']\n)\n\n# Split the tuple index into two columns\ncorrelation_df.index = pd.MultiIndex.from_tuples(correlation_df.index, names=['station', 'year'])\ncorrelation_df = correlation_df.reset_index()\n\nprint(correlation_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        station  year  rain_sun_corr\n0     Aberporth  1941            NaN\n1     Aberporth  1942      -0.432952\n2     Aberporth  1943      -0.527707\n3     Aberporth  1944      -0.440227\n4     Aberporth  1945      -0.251566\n...         ...   ...            ...\n3268  Yeovilton  2020      -0.653444\n3269  Yeovilton  2021      -0.141005\n3270  Yeovilton  2022      -0.438216\n3271  Yeovilton  2023      -0.555453\n3272  Yeovilton  2024      -0.234487\n\n[3273 rows x 3 columns]\n```\n:::\n:::\n\n\n::: {#62f829a6 .cell execution_count=10}\n``` {.python .cell-code}\nsns.scatterplot(data=correlation_df, x='year', y='rain_sun_corr', hue='station', alpha=0.5, legend=False)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](UK_weather_files/figure-html/cell-11-output-1.png){}\n:::\n:::\n\n\n::: {#b4d068c6 .cell execution_count=11}\n``` {.python .cell-code}\ndf_grp[df_grp['quarter'] == '1926–1950']\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>station</th>\n      <th>year</th>\n      <th>month</th>\n      <th>quarter</th>\n      <th>tmax</th>\n      <th>tmin</th>\n      <th>tdiff</th>\n      <th>af</th>\n      <th>rain</th>\n      <th>sun</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>1</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>2</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>3</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>4</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>Aberporth</td>\n      <td>1853</td>\n      <td>5</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>381816</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>8</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381821</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>9</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381826</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>10</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381831</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>11</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>381836</th>\n      <td>Yeovilton</td>\n      <td>2024</td>\n      <td>12</td>\n      <td>1926–1950</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>76368 rows × 10 columns</p>\n</div>\n```\n:::\n:::\n\n\n##Plotting\n\n::: {#6d2bb875 .cell execution_count=12}\n``` {.python .cell-code}\ncol_palette = 'autumn_r' #'Wistia'\nmonth_labels = ['J', 'F', 'M', 'A', 'M', 'J', 'J', 'A', 'S', 'O', 'N', 'D']\nsns.set_context(\"talk\", font_scale=2.2)  \nbg_color = '#390099'\nfg_color = '#eef4ed'\n\n# Create a faceted stripplot\n\ng = sns.catplot(\n    data=df_grp,\n    x='month',\n    y='tmax',\n    hue='tdiff',\n    col='station',\n    kind='strip',\n    palette=col_palette,\n    dodge=False,\n    sharey=True,\n    height=5,\n    aspect=1.2,\n    col_wrap=8,\n    legend=False,\n)\ng.fig.patch.set_facecolor(bg_color)  \n\n# Set axes background color\nfor ax in g.axes.flat:\n    ax.set_facecolor(bg_color)  \n    ax.tick_params(axis='y', colors=fg_color)\n    for spine in ax.spines.values():\n        spine.set_color(fg_color)\n\ncol_wrap = 8\n\nfor i, ax in enumerate(g.axes.flat):\n    if i % col_wrap != 0:  # Not the first column in each row\n        ax.set_ylabel('')\n        ax.tick_params(axis='y', left=False, labelleft=False, colors=fg_color)\n        ax.tick_params(axis='x', colors=fg_color)\n        sns.despine(ax=ax,left=True)\n    else:\n        ax.tick_params(axis='x', colors=fg_color)\n\n# Adjust layout\ng.set_titles(\"{col_name}\", color=fg_color)\ng.set_axis_labels(\"\", \"\")\ng.set_xticklabels(month_labels, fontdict={'family': 'monospace', 'color': fg_color})\ng.fig.text(-0.005, 0.5, 'Maximum temperature (°C)', va='center', rotation='vertical', color=fg_color)\n\nnorm = mcolors.Normalize(vmin=df_grp['tdiff'].min(), vmax=df_grp['tdiff'].max())\nsm = cm.ScalarMappable(cmap='autumn_r', norm=norm)\nsm.set_array([])  # Required for colorbar\n\n#g.fig.subplots_adjust(right=0.85)\n# Add the colorbar to the figure\ncbar_ax = g.fig.add_axes([0.7, 0.08, 0.2, 0.01])  # [left, bottom, width, height]\ncbar = g.fig.colorbar(sm, cax=cbar_ax, orientation='horizontal')\ncbar.set_label('Temperature Difference', color=fg_color)\n\n# Change tick label color\ncbar.ax.xaxis.set_tick_params(color=fg_color)  # Tick marks\nfor label in cbar.ax.get_xticklabels():\n    label.set_color(fg_color)  # Tick label text\ntitle = 'Monthly variations in maximum temperature at 37 weather stations in the UK. Points are colored based on the difference in maximum and minimum temperatures.'    \n\ng.fig.text(0.63, 0.13,textwrap.fill(title, width=55), color=fg_color, family='Serif', fontweight='bold', fontsize=38)           \nplt.tight_layout()\nplt.savefig(\"UK_weather.png\", dpi=300, bbox_inches='tight', pad_inches=0.2)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](UK_weather_files/figure-html/cell-13-output-1.png){}\n:::\n:::\n\n\n",
    "supporting": [
      "UK_weather_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}