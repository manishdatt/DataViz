{
  "hash": "1657d35415a4b1e6d9af5bc5e199fe07",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Roundabouts across the world\nauthor: Manish Datt\ndate: '2025-12-16'\niso-date: '2025-12-16'\ndescription: >-\n  Distribution of roundabouts based on type and number of approaches.\nimage: roundabouts.png\ncategories:\n- ObservablePlot\n- TidyTuesday\nslug: 25C3\n---\n\n# TidyTuesday dataset of [{{<meta date>}}](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/{{<meta iso-date>}})\n\n```{=html}\n<head>\n<title>Roundabouts Line Plot</title>\n<script src=\"https://d3js.org/d3.v7.min.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.17/dist/plot.umd.min.js\"></script>\n<link rel=\"stylesheet\" href=\"https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css\">\n<script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n<script src=\"https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js\"></script>\n</head>\n\n<div id=\"controls\"></div>\n<div id=\"scatterplot\"></div>\n<div id=\"table\"></div>\n<script>\nd3.csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-12-16/roundabouts_clean.csv').then(data => {\n  // Parse numbers\n  data.forEach(d => {\n    d.approaches = +d.approaches;\n  });\n  // Filter for existing status\n  data = data.filter(d => d.status === \"Existing\");\n  // Get min and max approaches\n  const minApp = d3.min(data, d => d.approaches);\n  const maxApp = d3.max(data, d => d.approaches);\n  // Aggregate by type\n  const counts = d3.rollup(data, v => v.length, d => d.type);\n  const sumApproaches = d3.rollup(data, v => d3.sum(v, d => d.approaches), d => d.type);\n  const aggregated = Array.from(counts, ([type, count]) => ({type, count, sumApp: sumApproaches.get(type)}));\n  // Sort by count descending\n  aggregated.sort((a, b) => b.count - a.count);\n  const types = aggregated.map(d => d.type);\n\n  // Create checkboxes\n  const controls = document.getElementById('controls');\n  controls.style.display = 'flex';\n  controls.style.flexWrap = 'wrap';\n\n  // All checkbox\n  const allCheckbox = document.createElement('input');\n  allCheckbox.type = 'checkbox';\n  allCheckbox.id = 'all';\n  allCheckbox.onchange = () => {\n    const checked = allCheckbox.checked;\n    types.forEach(type => {\n      document.getElementById(`type-${type}`).checked = checked;\n    });\n    updatePlots();\n  };\n  const allLabel = document.createElement('label');\n  allLabel.htmlFor = 'all';\n  allLabel.textContent = 'All';\n  allLabel.style.marginRight = '20px';\n  controls.appendChild(allCheckbox);\n  controls.appendChild(allLabel);\n\n  types.forEach((type, i) => {\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.id = `type-${type}`;\n    checkbox.checked = true; // default all checked\n    checkbox.onchange = updatePlots;\n    const label = document.createElement('label');\n    label.htmlFor = `type-${type}`;\n    label.textContent = type;\n    label.style.marginRight = '10px';\n    controls.appendChild(checkbox);\n    controls.appendChild(label);\n  });\n\n  // Add slider for max approaches\n  const sliderDiv = document.createElement('div');\n  sliderDiv.style.marginTop = '20px';\n  const slider = document.createElement('input');\n  slider.type = 'range';\n  slider.id = 'approachesSlider';\n  slider.min = 4;\n  slider.max = maxApp;\n  slider.value = maxApp;\n  sliderDiv.appendChild(slider);\n  const sliderLabel = document.createElement('label');\n  sliderLabel.htmlFor = 'approachesSlider';\n  sliderLabel.textContent = 'Max Approaches: ';\n  const sliderValue = document.createElement('span');\n  sliderValue.id = 'sliderValue';\n  sliderValue.textContent = maxApp;\n  sliderLabel.appendChild(sliderValue);\n  sliderDiv.appendChild(sliderLabel);\n  document.body.insertBefore(sliderDiv, document.getElementById('scatterplot'));\n  slider.addEventListener('input', () => {\n    document.getElementById('sliderValue').textContent = slider.value;\n    updatePlots();\n  });\n\n  function updatePlots() {\n    const selectedTypes = types.filter(type => document.getElementById(`type-${type}`).checked);\n    const maxApproaches = +document.getElementById('approachesSlider').value;\n    const filteredData = data.filter(d => selectedTypes.includes(d.type) && d.approaches <= maxApproaches);\n    const filteredAggregated = d3.rollup(filteredData, v => v.length, d => d.type);\n    const aggregatedArray = Array.from(filteredAggregated, ([type, count]) => ({type, count}));\n    aggregatedArray.sort((a, b) => b.count - a.count);\n\n    // Scatter plot\n    const countMap = new Map();\n    filteredData.forEach(d => {\n      const key = `${d.type}-${d.approaches}`;\n      countMap.set(key, (countMap.get(key) || 0) + 1);\n    });\n    const maxApp = d3.max(filteredData, d => d.approaches) || 10;\n//    console.log(\"Y-tick labels:\", filteredAggregated.map(d => d.type));\n    const scatterplot = Plot.plot({\n      title: `Distribution of types of roundabouts based on the number of approaches. There are ${data.filter(d => d.type === \"Roundabout\" && d.approaches === 4).length.toLocaleString()} roundabouts with four approaches.`,\n      x: { label: \"Number of Approaches\", tickSize: 0, ticks: d3.range(0, maxApp + 1), tickFormat: d => d.toFixed(0), labelOffset: 35 },\n      y: { label: \"\", domain: aggregatedArray.map(d => d.type), tickSize: 0 },\n      color: { scheme: \"plasma\", reverse: true },\n      marginLeft: 200,\n      marginBottom: 45,\n      height: 200,\n      style: \"background-color: lightgray; font-size: 14px;\",\n      marks: [\n        Plot.dot(filteredData, { x: \"approaches\", y: \"type\", fill: d => countMap.get(`${d.type}-${d.approaches}`), r: 5, stroke: \"none\", tip: {format: {x: false}} })\n      ]\n    });\n    document.getElementById('scatterplot').innerHTML = '';\n    const legend = Plot.legend({color: scatterplot.scale(\"color\"), label: \"Count\"});\n//    legend.style.transform = \"rotate(90deg)\";\n//    legend.style.transformOrigin = \"left top\";\n    legend.style.backgroundColor = \"transparent\";\n    legend.style.width = \"150px\";\n    legend.style.position = \"relative\";\n    legend.style.top = \"240px\";\n    legend.style.left = \"10px\";\n    legend.style.fontSize = \"14px\";\n    document.getElementById('scatterplot').appendChild(legend);\n    document.getElementById('scatterplot').appendChild(scatterplot);\n\n  }\n  // Create table\n  const tableDiv = document.getElementById('table');\n  tableDiv.style.width = '100vw';\n  tableDiv.style.overflowX = 'auto';\n  const table = document.createElement('table');\n  table.id = 'dataTable';\n  table.style.width = '100%';\n  const thead = document.createElement('thead');\n  const headerRow = document.createElement('tr');\n  Object.keys(data[0]).forEach(key => {\n    const th = document.createElement('th');\n    th.textContent = key;\n    headerRow.appendChild(th);\n  });\n  thead.appendChild(headerRow);\n  table.appendChild(thead);\n  const tbody = document.createElement('tbody');\n  data.slice(0, 100).forEach(row => {\n    const tr = document.createElement('tr');\n    Object.values(row).forEach(val => {\n      const td = document.createElement('td');\n      td.textContent = val;\n      tr.appendChild(td);\n    });\n    tbody.appendChild(tr);\n  });\n  table.appendChild(tbody);\n  tableDiv.appendChild(table);\n\n  // Initialize DataTable\n  $('#dataTable').DataTable({\n    pageLength: 5,\n    lengthMenu: [5, 10, 25] \n  });\n\n  updatePlots(); // initial render\n});\n</script>\n  <style>\n    figure {\n  background-color: lightgray;\n  margin: 0;\n  width: 640px;\n  }\n  figure h2 {\n  padding-top: 10px;\n  padding-left: 10px;\n  padding-right: 10px;\n  margin: 0;\n  margin-bottom: -10px;\n  font-size: 20px;\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  font-weight: 500;\n}\n  </style>\n```\n\n## Import required libraries\n\n```javascript\n<script src=\"https://d3js.org/d3.v7.min.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.17/dist/plot.umd.min.js\"></script>\n<link rel=\"stylesheet\" href=\"https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css\">\n<script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n<script src=\"https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js\"></script>\n\n```\n\n## Create placeholders\n\n```{html}\n<div id=\"controls\"></div>\n<div id=\"scatterplot\"></div>\n<div id=\"table\"></div>\n```\n\n## Plotting\n\n```{javascript}\n<script>\nd3.csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-12-16/roundabouts_clean.csv').then(data => {\n  // Parse numbers\n  data.forEach(d => {\n    d.approaches = +d.approaches;\n  });\n  // Filter for existing status\n  data = data.filter(d => d.status === \"Existing\");\n  // Get min and max approaches\n  const minApp = d3.min(data, d => d.approaches);\n  const maxApp = d3.max(data, d => d.approaches);\n  // Aggregate by type\n  const counts = d3.rollup(data, v => v.length, d => d.type);\n  const sumApproaches = d3.rollup(data, v => d3.sum(v, d => d.approaches), d => d.type);\n  const aggregated = Array.from(counts, ([type, count]) => ({type, count, sumApp: sumApproaches.get(type)}));\n  // Sort by count descending\n  aggregated.sort((a, b) => b.count - a.count);\n  const types = aggregated.map(d => d.type);\n\n  // Create checkboxes\n  const controls = document.getElementById('controls');\n  controls.style.display = 'flex';\n  controls.style.flexWrap = 'wrap';\n\n  // All checkbox\n  const allCheckbox = document.createElement('input');\n  allCheckbox.type = 'checkbox';\n  allCheckbox.id = 'all';\n  allCheckbox.onchange = () => {\n    const checked = allCheckbox.checked;\n    types.forEach(type => {\n      document.getElementById(`type-${type}`).checked = checked;\n    });\n    updatePlots();\n  };\n  const allLabel = document.createElement('label');\n  allLabel.htmlFor = 'all';\n  allLabel.textContent = 'All';\n  allLabel.style.marginRight = '20px';\n  controls.appendChild(allCheckbox);\n  controls.appendChild(allLabel);\n\n  types.forEach((type, i) => {\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.id = `type-${type}`;\n    checkbox.checked = true; // default all checked\n    checkbox.onchange = updatePlots;\n    const label = document.createElement('label');\n    label.htmlFor = `type-${type}`;\n    label.textContent = type;\n    label.style.marginRight = '10px';\n    controls.appendChild(checkbox);\n    controls.appendChild(label);\n  });\n\n  // Add slider for max approaches\n  const sliderDiv = document.createElement('div');\n  sliderDiv.style.marginTop = '20px';\n  const slider = document.createElement('input');\n  slider.type = 'range';\n  slider.id = 'approachesSlider';\n  slider.min = 4;\n  slider.max = maxApp;\n  slider.value = maxApp;\n  sliderDiv.appendChild(slider);\n  const sliderLabel = document.createElement('label');\n  sliderLabel.htmlFor = 'approachesSlider';\n  sliderLabel.textContent = 'Max Approaches: ';\n  const sliderValue = document.createElement('span');\n  sliderValue.id = 'sliderValue';\n  sliderValue.textContent = maxApp;\n  sliderLabel.appendChild(sliderValue);\n  sliderDiv.appendChild(sliderLabel);\n  document.body.insertBefore(sliderDiv, document.getElementById('scatterplot'));\n  slider.addEventListener('input', () => {\n    document.getElementById('sliderValue').textContent = slider.value;\n    updatePlots();\n  });\n\n  function updatePlots() {\n    const selectedTypes = types.filter(type => document.getElementById(`type-${type}`).checked);\n    const maxApproaches = +document.getElementById('approachesSlider').value;\n    const filteredData = data.filter(d => selectedTypes.includes(d.type) && d.approaches <= maxApproaches);\n    const filteredAggregated = d3.rollup(filteredData, v => v.length, d => d.type);\n    const aggregatedArray = Array.from(filteredAggregated, ([type, count]) => ({type, count}));\n    aggregatedArray.sort((a, b) => b.count - a.count);\n\n    // Bar plot\n    const barplot = Plot.plot({\n      x: { label: \"Total Count\" },\n      y: { label: \"Type\", domain: aggregatedArray.map(d => d.type), padding: 0 },\n      marginLeft: 150,\n      marginBottom: 40,\n      height: 200,\n      marks: [\n        Plot.barX(aggregatedArray, { x: \"count\", y: \"type\" })\n      ]\n    });\n    document.getElementById('barplot').innerHTML = '';\n    document.getElementById('barplot').appendChild(barplot);\n\n    // Scatter plot\n    const countMap = new Map();\n    filteredData.forEach(d => {\n      const key = `${d.type}-${d.approaches}`;\n      countMap.set(key, (countMap.get(key) || 0) + 1);\n    });\n    const maxApp = d3.max(filteredData, d => d.approaches) || 10;\n//    console.log(\"Y-tick labels:\", filteredAggregated.map(d => d.type));\n    const scatterplot = Plot.plot({\n      title: `Distribution of types of roundabouts based on the number of approaches. There are ${data.filter(d => d.type === \"Roundabout\" && d.approaches === 4).length.toLocaleString()} roundabouts with four approaches.`,\n      x: { label: \"Number of Approaches\", tickSize: 0, ticks: d3.range(0, maxApp + 1), tickFormat: d => d.toFixed(0), labelOffset: 35 },\n      y: { label: \"\", domain: aggregatedArray.map(d => d.type), tickSize: 0 },\n      color: { scheme: \"plasma\", reverse: true },\n      marginLeft: 200,\n      marginBottom: 45,\n      height: 200,\n      style: \"background-color: lightgray; font-size: 14px;\",\n      marks: [\n        Plot.dot(filteredData, { x: \"approaches\", y: \"type\", fill: d => countMap.get(`${d.type}-${d.approaches}`), r: 5, stroke: \"none\", tip: {format: {x: false}} })\n      ]\n    });\n    document.getElementById('scatterplot').innerHTML = '';\n    const legend = Plot.legend({color: scatterplot.scale(\"color\"), label: \"Count\"});\n//    legend.style.transform = \"rotate(90deg)\";\n//    legend.style.transformOrigin = \"left top\";\n    legend.style.backgroundColor = \"transparent\";\n    legend.style.width = \"150px\";\n    legend.style.position = \"relative\";\n    legend.style.top = \"240px\";\n    legend.style.left = \"10px\";\n    legend.style.fontSize = \"14px\";\n    document.getElementById('scatterplot').appendChild(legend);\n    document.getElementById('scatterplot').appendChild(scatterplot);\n\n  }\n  // Create table\n  const tableDiv = document.getElementById('table');\n  tableDiv.style.width = '100vw';\n  tableDiv.style.overflowX = 'auto';\n  const table = document.createElement('table');\n  table.id = 'dataTable';\n  table.style.width = '100%';\n  const thead = document.createElement('thead');\n  const headerRow = document.createElement('tr');\n  Object.keys(data[0]).forEach(key => {\n    const th = document.createElement('th');\n    th.textContent = key;\n    headerRow.appendChild(th);\n  });\n  thead.appendChild(headerRow);\n  table.appendChild(thead);\n  const tbody = document.createElement('tbody');\n  data.slice(0, 100).forEach(row => {\n    const tr = document.createElement('tr');\n    Object.values(row).forEach(val => {\n      const td = document.createElement('td');\n      td.textContent = val;\n      tr.appendChild(td);\n    });\n    tbody.appendChild(tr);\n  });\n  table.appendChild(tbody);\n  tableDiv.appendChild(table);\n\n  // Initialize DataTable\n  $('#dataTable').DataTable({\n    pageLength: 5,\n    lengthMenu: [5, 10, 25] \n  });\n\n  updatePlots(); // initial render\n});\n</script>\n  <style>\n    figure {\n  background-color: lightgray;\n  margin: 0;\n  width: 640px;\n  }\n  figure h2 {\n  padding-top: 10px;\n  padding-left: 10px;\n  padding-right: 10px;\n  margin: 0;\n  margin-bottom: -10px;\n  font-size: 20px;\n  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n  font-weight: 500;\n}\n  </style>\n\n```\n\n",
    "supporting": [
      "Roundabouts_files"
    ],
    "filters": [],
    "includes": {}
  }
}