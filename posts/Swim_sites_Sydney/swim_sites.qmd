---
title: "Water Quality at Sydney Beaches"
author: "Manish Datt"
date: "5/20/2025"
description: "Ranking of Sydney beaches based on *Enterococci* concentration"
image: "swim_sites.png"
categories: [ggplot2, heatmap,TidyTuesday]
slug: "2553"
---

## TidyTuesday data for [2025-05-20](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-05-20/readme.md)

```{r}
#| warning: false
library(tidyverse)
library(ggtext)
```

```{r}
#| warning: false
water_quality <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-05-20/water_quality.csv')
water_quality
```

```{r}
glimpse(water_quality)
```

## Data Wrangling

```{r}
wq_grp <- water_quality %>%
  filter(!is.na(enterococci_cfu_100ml)) %>% 
  mutate(date_y = format(date, "%Y")) %>% 
  group_by(date_y, swim_site) %>% 
  summarise(mean_enterococci = mean(enterococci_cfu_100ml, na.rm = TRUE)) %>% 
  slice_min(order_by = mean_enterococci, n = 5)

site_freq <- wq_grp %>%
  ungroup() %>% 
  count(swim_site, sort = TRUE)
```

## Plotting

```{r fig.width=10, fig.height=6}
wq_grp%>% 
  mutate(swim_site = fct_rev(factor(swim_site, levels = site_freq$swim_site))) %>% 
  ggplot(aes(x = date_y, y=swim_site, fill=mean_enterococci)) +
  scale_fill_gradient(low = "lightblue", high = "blue") +
  geom_tile(color="white") +
  labs(
    title = "Year-wise top five swim-sites based on the lowest *Enterococci* concentration",
    x = element_blank(),
    y = element_blank(),
    fill = "Average *Enterococci* <br> CFU/100ml",
    caption = "Colony Forming Units (CFU) indicate number of viable bacteria that can form colonies when grown in a lab."
  ) +
  theme_minimal() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.text.x = element_text(angle = 90, hjust = 1),
    plot.title = element_textbox_simple(
      padding = margin(5.5, 5.5, 5.5, 5.5),
      margin = margin(5, 0, 10, 0)),
    legend.title = element_markdown(hjust = 0.5),
    legend.position = "inside",
    legend.position.inside = c(0.80, 0.1),
    legend.title.position = "top",
    plot.caption = element_textbox_simple(
      margin = margin(0, 0, 10, 175),
      padding = margin(5.5, 0, 0, 0),
      hjust = 0,
      size = 8,
      color = "gray40",
      lineheight = 1.2
    ),
    axis.title.x = element_text(family = "Consolas"),
    ) +
  guides(fill = guide_colorbar(direction = "horizontal", barheight=.5)) +
   coord_fixed(ratio = 1) 

#ggsave("swim_sites2.png", width = 8, height = 6, dpi = 300, bg = "white")

```
